{
  "hash": "ce2f17960abc7c1d6aa7dd7131c756e9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Enrichment analysis\"\neditor_options: \n  chunk_output_type: console\nformat: html\n---\n\n\n## Material\n\n{{< downloadthis ../assets/pdf/10_enrichment_analysis.pdf dname=\"enrichment_analysis\" label=\"Download the presentation\" icon=\"filetype-pdf\" >}}\n\n- [MSigDB](http://www.gsea-msigdb.org/gsea/msigdb/index.jsp)\n- `clusterProfiler` [vignette](https://bioconductor.org/packages/release/bioc/vignettes/clusterProfiler/inst/doc/clusterProfiler.html)\n- [Revigo](http://revigo.irb.hr/)\n- [Signaling Pathway Impact Analysis (SPIA)](https://bioconductor.org/packages/release/bioc/html/SPIA.html)\n- Original [paper](https://www.pnas.org/content/102/43/15545) on GSEA\n- [STRING](https://string-db.org/) for protein-protein interactions\n- [GO figure!](https://gitlab.com/evogenlab/GO-Figure) for plotting GO terms and the associated [paper](https://www.frontiersin.org/articles/10.3389/fbinf.2021.638255/full)\n\n## Exercises\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntum_vs_norm <- readRDS(\"day3/tum_vs_norm_day3-2.rds\")\nlimma_de <- readRDS(\"day3/limma_de_day3-2.rds\")\nproB <- readRDS(\"day3/proB_day3-2.rds\")\n```\n:::\n\n\nLoad the following packages:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(clusterProfiler)\nlibrary(ggiraph)\nlibrary(enrichplot)\n```\n:::\n\n\nIf the `FindMarkers` or `FindAllMarkers` functions were used,\nwe obtained a table listing only the significant genes,\nbut we don't have any information of fold change for the non-significant\ngenes. Therefore, we can use the over-representation analysis\nwhich is a threshold-based method.\nUsing our list of significant genes, we can test\nif any gene set is over-represented among significant genes or not using a test\nsimilar to a Fisher test to compare differences in proportions.\n\nThe `clusterProfiler` package provides functions for over-representation\nanalysis of Gene Ontology gene sets (among other functions, including functions for actual GSEA) or KEGG gene sets.\n\nGenes can be labeled using different types of labels, eg\nsymbol, Ensembl ID, Entrez ID. To list the allowed\nlabel types use:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# BiocManager::install(\"org.Hs.eg.db\", update = FALSE)\nlibrary(org.Hs.eg.db)\nAnnotationDbi::keytypes(org.Hs.eg.db)\n```\n:::\n\n\n::: {.callout-info}\n## About OrgDb\nFor other organisms, you can find available OrgDbs at [bioconductor](http://bioconductor.org/packages/release/BiocViews.html#___OrgDb)\n:::\n\nLet's select a set of genes that are downregulated in the tumor cells compared to normal:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntum_down  <- subset(limma_de,\n                    limma_de$logFC < -1 \n                      & limma_de$adj.P.Val <  0.05)\ntum_down_genes <- rownames(tum_down)\n```\n:::\n\n\nWe can do a Gene Ontology term over-representation analysis based on this set of genes. Make sure you check out the help of this function to understand its arguments:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n?enrichGO\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntum_vs_norm_go <- clusterProfiler::enrichGO(tum_down_genes,\n                                            \"org.Hs.eg.db\",\n                                            keyType = \"SYMBOL\",\n                                            ont = \"BP\",\n                                            minGSSize = 50)\n```\n:::\n\n\nThe results are stored in the `@result` slot:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nView(tum_vs_norm_go@result)\n```\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|           |ID         |Description                          |GeneRatio |BgRatio   | RichFactor| FoldEnrichment|   zScore|\n|:----------|:----------|:------------------------------------|:---------|:---------|----------:|--------------:|--------:|\n|GO:0007059 |GO:0007059 |chromosome segregation               |105/804   |434/18860 |  0.2419355|       5.675253| 20.79271|\n|GO:0000070 |GO:0000070 |mitotic sister chromatid segregation |65/804    |192/18860 |  0.3385417|       7.941413| 20.39981|\n|GO:0098813 |GO:0098813 |nuclear chromosome segregation       |82/804    |323/18860 |  0.2538700|       5.955209| 18.95484|\n|GO:0000819 |GO:0000819 |sister chromatid segregation         |70/804    |233/18860 |  0.3004292|       7.047381| 19.59975|\n|GO:0140014 |GO:0140014 |mitotic nuclear division             |73/804    |281/18860 |  0.2597865|       6.093996| 18.15420|\n|GO:0000280 |GO:0000280 |nuclear division                     |90/804    |453/18860 |  0.1986755|       4.660473| 16.64069|\n\n\n:::\n:::\n\n\n::: {.callout-note}\n## The columns `GeneRatio` and `BgRatio`\nThe columns `GeneRatio` and `BgRatio` that are in the `enrichResult` object represent the numbers that are used as input for the Fisher's exact test. \n\nThe two numbers (M/N) in the `GeneRatio` column are:\n\n* M: Number of genes of interest (in our case `tum_down_genes`) that are in the GO set\n* N: Number of genes of interest with any GO annoation.\n\nThe two numbers (k/n) in the `BgRatio` column are:\n\n* k: Number of genes in the universe that are in the GO set\n* n: Number of genes in the universe with any GO annoation\n\nA low p-value resulting from the Fisher's exact means that M/N is signficantly greater than k/n. \n:::\n\nSome GO terms seem redundant because they contain many of the same genes, which is a characteristic of Gene Ontology gene sets. We can simplify this list by removing redundant gene sets:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nenr_go <- clusterProfiler::simplify(tum_vs_norm_go)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nView(enr_go@result)\n```\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|           |ID         |Description                               |GeneRatio |BgRatio   | RichFactor| FoldEnrichment|   zScore|\n|:----------|:----------|:-----------------------------------------|:---------|:---------|----------:|--------------:|--------:|\n|GO:0007059 |GO:0007059 |chromosome segregation                    |105/804   |434/18860 |  0.2419355|       5.675253| 20.79271|\n|GO:0000070 |GO:0000070 |mitotic sister chromatid segregation      |65/804    |192/18860 |  0.3385417|       7.941413| 20.39981|\n|GO:0098813 |GO:0098813 |nuclear chromosome segregation            |82/804    |323/18860 |  0.2538700|       5.955209| 18.95484|\n|GO:0000280 |GO:0000280 |nuclear division                          |90/804    |453/18860 |  0.1986755|       4.660473| 16.64069|\n|GO:1905818 |GO:1905818 |regulation of chromosome separation       |32/804    |76/18860  |  0.4210526|       9.876931| 16.36260|\n|GO:1901987 |GO:1901987 |regulation of cell cycle phase transition |75/804    |468/18860 |  0.1602564|       3.759249| 12.75486|\n\n\n:::\n:::\n\n\nWe can quite easily generate a plot called an enrichment map with the `enrichplot` package:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nenrichplot::emapplot(enrichplot::pairwise_termsim(enr_go),\n                     showCategory = 30)\n```\n:::\n\n\nInstead of testing for Gene Ontology terms, we can also test for other gene set collections. For example the Hallmark collection from [MSigDB](http://www.gsea-msigdb.org/gsea/msigdb/index.jsp):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(msigdbr)\nlibrary(msigdbdf)\ngmt <- msigdbr::msigdbr(species = \"human\", category = \"H\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The `category` argument of `msigdbr()` is deprecated as of msigdbr 10.0.0.\nâ„¹ Please use the `collection` argument instead.\n```\n\n\n:::\n:::\n\n\nWe can use the function `enricher` to test for over-representation of any set of genes of the Hallmark collection. We have to include the \"universe\", i.e. the full list of background, non significant genes, against which to test for differences in proportions:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntum_vs_norm_enrich <- clusterProfiler::enricher(gene = tum_down_genes,\n                                                universe = rownames(proB),\n                                                pAdjustMethod = \"BH\",\n                                                pvalueCutoff  = 0.05,\n                                                qvalueCutoff  = 0.05,\n                                                TERM2GENE = gmt[,c(\"gs_name\", \"gene_symbol\")])\n```\n:::\n\n\nWhen using the genes down-regulated in tumor, among the over-represented Hallmark gene sets, we have `HALLMARK_G2M_CHECKPOINT`, which includes genes involved in the G2/M checkpoint in the progression through the cell division cycle.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nView(tum_vs_norm_enrich@result[tum_vs_norm_enrich@result$p.adjust < 0.05,])\n```\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|                                |ID                              |Description                     |GeneRatio |BgRatio  | RichFactor| FoldEnrichment|    zScore|\n|:-------------------------------|:-------------------------------|:-------------------------------|:---------|:--------|----------:|--------------:|---------:|\n|HALLMARK_E2F_TARGETS            |HALLMARK_E2F_TARGETS            |HALLMARK_E2F_TARGETS            |80/344    |195/3857 |  0.4102564|       4.599881| 16.141910|\n|HALLMARK_G2M_CHECKPOINT         |HALLMARK_G2M_CHECKPOINT         |HALLMARK_G2M_CHECKPOINT         |67/344    |187/3857 |  0.3582888|       4.017209| 13.234324|\n|HALLMARK_MITOTIC_SPINDLE        |HALLMARK_MITOTIC_SPINDLE        |HALLMARK_MITOTIC_SPINDLE        |48/344    |197/3857 |  0.2436548|       2.731909|  7.807757|\n|HALLMARK_MYC_TARGETS_V1         |HALLMARK_MYC_TARGETS_V1         |HALLMARK_MYC_TARGETS_V1         |33/344    |193/3857 |  0.1709845|       1.917113|  4.090088|\n|HALLMARK_ESTROGEN_RESPONSE_LATE |HALLMARK_ESTROGEN_RESPONSE_LATE |HALLMARK_ESTROGEN_RESPONSE_LATE |28/344    |164/3857 |  0.1707317|       1.914280|  3.743863|\n\n\n:::\n:::\n\n\n### Clear environment\n\nClear your environment:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrm(list = ls())\ngc()\n.rs.restartR()\n```\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}